<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <title>واجهة باسل | Hologram Card</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Inter:wght@300;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLpIqG9yFqT2F/d9gK9T/t6W6Bf9Bf1p6P6pP9p9x6wz5z5v5c5q6v8/x4w5g6y7g/a7f8e3f9a9c8d5c9c9" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style id="theme-styles">
    :root {
      /* Dark Theme Defaults */
      --bg: #06070a;
      --card-bg-gradient: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
      --text-primary: #dbeafe;
      --text-secondary: #9fb3d8;
      --accent: #6ee7b7;
      --accent-secondary: #60a5fa;
      --glass: rgba(255, 255, 255, 0.04);
      --glass-2: rgba(255, 255, 255, 0.02);
      --border: rgba(255, 255, 255, 0.06);
      --glow-1: rgba(110, 231, 183, 0.06);
      --glow-2: rgba(99, 102, 241, 0.03);
      --box-shadow: 0 10px 40px rgba(2, 6, 23, 0.6);
      --ui-panel-bg: rgba(15, 23, 36, 0.9);
      --ui-border: rgba(255, 255, 255, 0.1);
    }
  </style>
  <style>
    /* Global Styles */
    *, *:before, *:after { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; font-family: 'Inter', 'Cairo', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body { 
      background: linear-gradient(180deg, var(--bg, #06070a) 0%, #081129 70%); 
      overflow: hidden; 
      color: var(--text-primary); 
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      transition: background-color 0.5s ease;
    }
    button { transition: all 0.2s ease-in-out; }

    /* Canvas & Wrapper */
    canvas#bg { position: fixed; inset: 0; z-index: 0; }
    .wrap { position: relative; z-index: 2; display: grid; place-items: center; height: 100vh; padding: 24px; overflow-y: auto; }

    /* Card Component */
    .card {
      width: 760px; max-width: 95%; min-height: 420px; border-radius: 18px; padding: 26px;
      backdrop-filter: blur(8px);
      background: var(--card-bg-gradient); 
      box-shadow: var(--box-shadow);
      display: grid; grid-template-columns: 320px 1fr; gap: 22px; align-items: center;
      transform-style: preserve-3d; transition: transform 0.25s ease, box-shadow 0.3s ease;
      cursor: grab;
      position: relative;
    }
    .card:active { cursor: grabbing; }

    /* Left Section */
    .left { display: flex; flex-direction: column; gap: 14px; }
    .avatar { 
      height: 220px; border-radius: 12px; overflow: hidden; position: relative;
      box-shadow: 0 6px 24px rgba(2, 6, 23, 0.7); 
      border: 1px solid var(--border);
    }
    .avatar .holo { 
      position: absolute; inset: 0; 
      background: linear-gradient(180deg, rgba(110, 231, 183, 0.08), transparent 60%); 
      display: flex; align-items: center; justify-content: center;
      transition: opacity 0.4s ease;
    }
    .avatar svg { width: 100%; height: 100%; display: block; }
    
    /* Alien Eyes CSS */
    .alien-eye { 
      fill: var(--text-primary); 
      transform-origin: center center; 
      transition: transform 0.1s ease-out;
    }

    /* Text & Tags */
    h1 { font-size: 24px; margin: 0 0 6px 0; font-weight: 800; line-height: 1.2; }
    p.desc { margin: 0; color: var(--text-secondary); font-size: 16px; line-height: 1.5; }
    .meta { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 10px; }
    .chip { 
      padding: 8px 12px; 
      background: rgba(255, 255, 255, 0.03); 
      border-radius: 999px; font-weight: 600; 
      font-size: 12px;
      transition: background-color 0.3s ease;
    }
    
    /* Right Section */
    .right { display: flex; flex-direction: column; gap: 12px; }
    .controls { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
    button { 
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid var(--border); 
      padding: 10px 16px; 
      border-radius: 12px; 
      color: inherit; font-weight: 600; cursor: pointer;
      font-size: 14px;
    }
    button:hover { background: rgba(255, 255, 255, 0.1); }
    button:active { transform: scale(0.98); }

    .big { font-size: 48px; font-weight: 800; letter-spacing: -2px; line-height: 1; }
    .subtitle { color: var(--text-secondary); font-size: 14px; margin-top: 4px; }
    .stats { display: flex; gap: 12px; margin-top: 16px; flex-wrap: wrap; }
    .stat { 
      flex: 1; min-width: 80px; 
      padding: 12px; 
      background: var(--ui-panel-bg); 
      border-radius: 10px; text-align: center;
      border: 1px solid var(--border);
    }
    .stat .value { font-size: 20px; font-weight: 800; color: var(--accent); }
    .stat .label { font-size: 12px; color: var(--text-secondary); margin-top: 4px; }
    .footer { display: flex; justify-content: space-between; align-items: center; margin-top: 14px; flex-wrap: wrap; }
    .hint { font-size: 12px; color: var(--text-secondary); margin-top: 8px; }

    /* 3D glow */
    .glow {
      position: absolute; inset: -40px; border-radius: 24px; pointer-events: none;
      background: radial-gradient(circle at 20% 10%, var(--glow-1), transparent 6%),
                  radial-gradient(circle at 80% 80%, var(--glow-2), transparent 8%);
    }

    /* UI Panel */
    .ui-panel {
      position: fixed; top: 20px; right: 20px; z-index: 100;
      width: 280px; padding: 20px; border-radius: 12px;
      background: rgba(15, 23, 36, 0.9); backdrop-filter: blur(20px);
      border: 1px solid var(--ui-border);
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
      transform: translateX(120%);
      transition: transform 0.4s ease-out;
      opacity: 0;
      display: flex; flex-direction: column; gap: 15px;
    }
    .ui-panel.open { transform: translateX(0); opacity: 1; }
    .ui-panel h3 { margin: 0 0 10px 0; font-size: 18px; color: #fff; }
    .ui-panel label { font-size: 14px; display: block; margin-bottom: 5px; color: var(--text-secondary); }
    .ui-panel input[type="text"] {
      width: 100%; padding: 8px 12px; border: 1px solid var(--ui-border);
      background: rgba(255, 255, 255, 0.05); border-radius: 8px;
      color: var(--text-primary); font-family: inherit;
    }
    .ui-panel .input-group { margin-bottom: 15px; }
    .ui-panel .theme-options { display: flex; gap: 10px; }
    .ui-panel .theme-btn {
      width: 40px; height: 40px; border-radius: 8px; border: 2px solid transparent;
      cursor: pointer; position: relative;
    }
    .ui-panel .theme-btn.active { border-color: var(--accent); }
    .ui-panel .theme-btn.active:after {
        content: '✓'; position: absolute; top: 50%; left: 50%;
        transform: translate(-50%, -50%); color: white; font-size: 20px;
    }

    /* Tooltip */
    .tooltip-container { position: relative; }
    .tooltip-icon { font-size: 14px; color: var(--accent-secondary); cursor: pointer; margin-left: 5px; }
    .tooltip-content {
      position: absolute; top: 100%; left: 50%; transform: translateX(-50%);
      padding: 10px; border-radius: 8px; background: #2c3e50; color: #fff;
      white-space: nowrap; font-size: 12px; z-index: 10;
      opacity: 0; pointer-events: none; transition: opacity 0.3s;
      margin-top: 10px;
    }
    .tooltip-container:hover .tooltip-content { opacity: 1; }

    /* Responsive */
    @media (max-width: 768px) {
      .card { grid-template-columns: 1fr; }
      .left { align-items: center; text-align: center; }
      .meta { justify-content: center; }
      .right { align-items: center; text-align: center; }
      .controls { justify-content: center; }
      .footer { flex-direction: column; gap: 8px; text-align: center; }
      .ui-panel {
        width: 90%; right: 5%; top: 50%; transform: translate(-50%, 0); left: 50%;
        transition: transform 0.4s ease-out;
      }
      .ui-panel.open { transform: translate(-50%, 0); }
    }
  </style>
</head>
<body>
  <canvas id="bg"></canvas>

  <div class="wrap">
    <div class="card" id="card" title="اسحب وحرّك الماوس لتحصل على تأثير 3D">
      <div class="left">
        <div class="avatar" id="avatar">
          <div class="holo">
            <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
              <defs>
                <linearGradient id="g" x1="0" x2="1">
                  <stop offset="0" stop-color="#6ee7b7" stop-opacity="0.9"/>
                  <stop offset="1" stop-color="#60a5fa" stop-opacity="0.9"/>
                </linearGradient>
              </defs>
              <rect width="200" height="200" fill="#071029" />
              <g transform="translate(20,40) scale(0.9)">
                <path d="M58 10 C 30 10,20 38,20 60 C20 90,60 110,90 110 C120 110,160 90,160 60 C160 38,142 10,110 10 C90 10,74 10,58 10 Z" fill="url(#g)" opacity="0.18"></path>
                <g transform="translate(10,20)">
                  <circle id="leftEye" cx="50" cy="40" r="26" fill="none" stroke="#6ee7b7" stroke-width="1.6" opacity="0.9" class="alien-eye"/>
                  <circle id="rightEye" cx="114" cy="40" r="26" fill="none" stroke="#60a5fa" stroke-width="1.6" opacity="0.9" class="alien-eye"/>
                  <path d="M30 110 Q80 140 120 110" stroke="#9fb3d8" stroke-width="1.2" fill="none" opacity="0.6"/>
                </g>
              </g>
            </svg>
          </div>
        </div>

        <div>
          <h1 id="title">باسل. عملك جاهز.</h1>
          <p class="desc" id="description">واجهة مستخدم مُبهرة بتأثيرات بصرية عالية الأداء.</p>
        </div>

        <div class="meta" id="chips-container">
          <div class="chip">HTML</div>
          <div class="chip">CSS</div>
          <div class="chip">JS</div>
          <div class="chip">Performance</div>
          <div class="chip">Responsive</div>
        </div>
      </div>

      <div class="right">
        <div class="controls">
          <div>
            <div class="big" id="bigValue">100</div>
            <div class="subtitle" id="bigSubtitle">IQ الواجهة</div>
            <div class="stats">
              <div class="stat">
                <div class="value" id="stats-effects">12</div>
                <div class="label">تأثيرات</div>
              </div>
              <div class="stat">
                <div class="value" id="stats-load">0.3s</div>
                <div class="label">تحميل</div>
              </div>
              <div class="stat">
                <div class="value" id="stats-glow">100%</div>
                <div class="label">التوهج</div>
              </div>
            </div>
          </div>

          <div style="margin-left:auto; display:flex; flex-direction:column; gap:8px">
            <button id="toggleHolo" class="tooltip-container">
              تبديل الهولو
              <span class="tooltip-content">يُخفي أو يُظهر تأثير الهولوغرام.</span>
            </button>
            <button id="screenshot" class="tooltip-container">
              صورة للادعاء
              <span class="tooltip-content">يلتقط صورة للبطاقة لمشاركتها.</span>
            </button>
            <button id="confetti" class="tooltip-container">
              احتفال
              <span class="tooltip-content">انفجار من المبهجات.</span>
            </button>
          </div>
        </div>

        <div style="padding:12px; background:linear-gradient(180deg, var(--glass-2), transparent); border-radius:10px; border:1px solid var(--border);">
          <div style="font-weight:700">مواصفات سريعة</div>
          <p class="hint" id="specs-list">
            • تأثير انحناء ثلاثي الأبعاد بالماوس. 
            • خلفية تفاعلية بجزيئات. 
            • أزرار تفاعلية مع تأثيرات. 
            • ميزات قابلة للتخصيص.
          </p>
        </div>

        <div class="footer">
          <div class="hint">اضغط واسحب لتدوير البطاقة.</div>
          <div class="hint">استخدم لوحة التحكم للتعديل على الواجهة.</div>
        </div>
      </div>
      <div class="glow"></div>
    </div>
  </div>

  <div class="ui-panel" id="uiPanel">
    <h3>لوحة التحكم</h3>
    <div class="input-group">
      <label for="titleInput">عنوان الواجهة</label>
      <input type="text" id="titleInput" value="باسل. عملك جاهز." />
    </div>
    <div class="input-group">
      <label for="descInput">الوصف</label>
      <input type="text" id="descInput" value="واجهة مستخدم مُبهرة بتأثيرات بصرية عالية الأداء." />
    </div>
    <div class="input-group">
      <label for="bigValueInput">قيمة IQ</label>
      <input type="number" id="bigValueInput" value="100" />
    </div>
    <div class="input-group">
      <label>الثيمات</label>
      <div class="theme-options">
        <div class="theme-btn" data-theme="dark" style="background:#06070a; border:1px solid #1f2937;"></div>
        <div class="theme-btn" data-theme="light" style="background:#f8fafc; border:1px solid #e2e8f0;"></div>
        <div class="theme-btn" data-theme="forest" style="background:#1b2d18; border:1px solid #2e4a2c;"></div>
        <div class="theme-btn" data-theme="nebula" style="background:#26183d; border:1px solid #3c2a55;"></div>
      </div>
    </div>
  </div>

  <script type="module">
    import confetti from 'https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.0/+esm'

    // --- Core UI Logic Module ---
    const uiManager = (function() {
      const elements = {
        title: document.getElementById('title'),
        description: document.getElementById('description'),
        bigValue: document.getElementById('bigValue'),
        titleInput: document.getElementById('titleInput'),
        descInput: document.getElementById('descInput'),
        bigValueInput: document.getElementById('bigValueInput'),
        uiPanel: document.getElementById('uiPanel'),
        card: document.getElementById('card'),
        toggleHolo: document.getElementById('toggleHolo'),
        avatar: document.getElementById('avatar'),
        screenshotBtn: document.getElementById('screenshot'),
        confettiBtn: document.getElementById('confetti'),
        themeButtons: document.querySelectorAll('.theme-btn')
      };

      const state = {
        holoOn: true
      };

      function updateUIFromInputs() {
        elements.title.textContent = elements.titleInput.value;
        elements.description.textContent = elements.descInput.value;
        const targetValue = parseInt(elements.bigValueInput.value, 10);
        animateValue(targetValue);
      }

      function toggleUIPanel() {
        elements.uiPanel.classList.toggle('open');
      }

      function animateValue(target) {
        let val = parseInt(elements.bigValue.textContent, 10) || 0;
        const step = Math.ceil((target - val) / 30);
        if (step === 0 && val !== target) {
          elements.bigValue.textContent = target;
          return;
        }
        const interval = setInterval(() => {
          val += step;
          if ((step > 0 && val >= target) || (step < 0 && val <= target)) {
            val = target;
            clearInterval(interval);
          }
          elements.bigValue.textContent = val;
        }, 20);
      }

      function toggleHolo() {
        state.holoOn = !state.holoOn;
        elements.avatar.querySelector('.holo').style.opacity = state.holoOn ? 1 : 0.06;
      }

      function initializeEventListeners() {
        elements.titleInput.addEventListener('input', updateUIFromInputs);
        elements.descInput.addEventListener('input', updateUIFromInputs);
        elements.bigValueInput.addEventListener('input', updateUIFromInputs);
        elements.toggleHolo.addEventListener('click', toggleHolo);
        elements.screenshotBtn.addEventListener('click', async () => {
          try {
            const data = await htmlToImage(elements.card);
            downloadURI(data, `basel_claim_${Date.now()}.png`);
          } catch (e) {
            alert('فشل حفظ الصورة. جرب أخذ سكرين شوت.');
            console.error(e);
          }
        });
        elements.confettiBtn.addEventListener('click', () => {
          confetti({
            particleCount: 150,
            spread: 90,
            origin: { y: 0.6 }
          });
        });
        
        document.addEventListener('keydown', (e) => {
          if (e.key === 'u' || e.key === 'ء') { // Toggle with 'u' or 'ء' key
            toggleUIPanel();
          }
        });

        elements.themeButtons.forEach(btn => {
          btn.addEventListener('click', () => {
            const theme = btn.dataset.theme;
            applyTheme(theme);
            localStorage.setItem('user-theme', theme);
          });
        });
      }

      function applyTheme(theme) {
        const styleSheet = document.getElementById('theme-styles');
        let cssVars = '';
        switch(theme) {
          case 'dark':
            cssVars = `
              --bg: #06070a;
              --card-bg-gradient: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
              --text-primary: #dbeafe;
              --text-secondary: #9fb3d8;
              --accent: #6ee7b7;
              --accent-secondary: #60a5fa;
              --glass: rgba(255, 255, 255, 0.04);
              --glass-2: rgba(255, 255, 255, 0.02);
              --border: rgba(255, 255, 255, 0.06);
              --glow-1: rgba(110, 231, 183, 0.06);
              --glow-2: rgba(99, 102, 241, 0.03);
              --box-shadow: 0 10px 40px rgba(2, 6, 23, 0.6);
              --ui-panel-bg: rgba(15, 23, 36, 0.9);
              --ui-border: rgba(255, 255, 255, 0.1);
            `;
            break;
          case 'light':
            cssVars = `
              --bg: #f8fafc;
              --card-bg-gradient: linear-gradient(180deg, rgba(0,0,0,0.04), rgba(0,0,0,0.02));
              --text-primary: #1f2937;
              --text-secondary: #6b7280;
              --accent: #10b981;
              --accent-secondary: #3b82f6;
              --glass: rgba(0, 0, 0, 0.04);
              --glass-2: rgba(0, 0, 0, 0.02);
              --border: rgba(0, 0, 0, 0.1);
              --glow-1: rgba(16, 185, 129, 0.06);
              --glow-2: rgba(59, 130, 246, 0.03);
              --box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
              --ui-panel-bg: rgba(243, 244, 246, 0.9);
              --ui-border: rgba(0, 0, 0, 0.15);
            `;
            break;
          case 'forest':
            cssVars = `
              --bg: #1b2d18;
              --card-bg-gradient: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
              --text-primary: #e0f2fe;
              --text-secondary: #a7f3d0;
              --accent: #34d399;
              --accent-secondary: #059669;
              --glass: rgba(255, 255, 255, 0.03);
              --glass-2: rgba(255, 255, 255, 0.01);
              --border: rgba(255, 255, 255, 0.05);
              --glow-1: rgba(52, 211, 153, 0.06);
              --glow-2: rgba(5, 150, 105, 0.03);
              --box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
              --ui-panel-bg: rgba(27, 45, 24, 0.9);
              --ui-border: rgba(255, 255, 255, 0.08);
            `;
            break;
          case 'nebula':
            cssVars = `
              --bg: #26183d;
              --card-bg-gradient: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
              --text-primary: #e9d5ff;
              --text-secondary: #a855f7;
              --accent: #c4b5fd;
              --accent-secondary: #9333ea;
              --glass: rgba(255, 255, 255, 0.04);
              --glass-2: rgba(255, 255, 255, 0.02);
              --border: rgba(255, 255, 255, 0.06);
              --glow-1: rgba(196, 181, 253, 0.06);
              --glow-2: rgba(147, 51, 234, 0.03);
              --box-shadow: 0 10px 40px rgba(0, 0, 0, 0.6);
              --ui-panel-bg: rgba(38, 24, 61, 0.9);
              --ui-border: rgba(255, 255, 255, 0.1);
            `;
            break;
        }
        styleSheet.innerHTML = `:root { ${cssVars} }`;
        elements.themeButtons.forEach(btn => btn.classList.remove('active'));
        document.querySelector(`.theme-btn[data-theme="${theme}"]`).classList.add('active');
        document.body.style.background = `linear-gradient(180deg, var(--bg) 0%, #081129 70%)`;
      }

      function loadSavedTheme() {
        const savedTheme = localStorage.getItem('user-theme') || 'dark';
        applyTheme(savedTheme);
      }

      return {
        init: () => {
          initializeEventListeners();
          loadSavedTheme();
          animateValue(100);
          console.log('UI Manager initialized successfully.');
        }
      };
    })();

    // --- Alien Eyes Module ---
    const alienEyesManager = (function() {
        const leftEye = document.getElementById('leftEye');
        const rightEye = document.getElementById('rightEye');
        const avatar = document.getElementById('avatar');

        function moveEyes(e) {
            const rect = avatar.getBoundingClientRect();
            const svgCenterX = rect.left + rect.width / 2;
            const svgCenterY = rect.top + rect.height / 2;
            const eyeBase = 30; // base offset to make eyes appear more alien

            // Calculate angle for the left eye
            const leftEyeX = rect.left + 50;
            const leftEyeY = rect.top + 40;
            const angleLeft = Math.atan2(e.clientY - leftEyeY, e.clientX - leftEyeX);
            const moveXLeft = Math.cos(angleLeft) * eyeBase;
            const moveYLeft = Math.sin(angleLeft) * eyeBase;
            leftEye.style.transform = `translate(${moveXLeft}px, ${moveYLeft}px)`;

            // Calculate angle for the right eye
            const rightEyeX = rect.left + 114;
            const rightEyeY = rect.top + 40;
            const angleRight = Math.atan2(e.clientY - rightEyeY, e.clientX - rightEyeX);
            const moveXRight = Math.cos(angleRight) * eyeBase;
            const moveYRight = Math.sin(angleRight) * eyeBase;
            rightEye.style.transform = `translate(${moveXRight}px, ${moveYRight}px)`;
        }

        return {
            init: () => {
                document.addEventListener('mousemove', moveEyes);
                console.log('Alien Eyes Manager initialized.');
            }
        };
    })();

    // --- Particle & Canvas Module ---
    const particleManager = (function() {
      const canvas = document.getElementById('bg');
      const ctx = canvas.getContext('2d');
      let w, h;
      let particles = [];

      function resizeCanvas() {
        w = canvas.width = innerWidth;
        h = canvas.height = innerHeight;
        initParticles();
      }

      function initParticles() {
        particles = [];
        const count = Math.max(Math.floor((w * h) / 60000), 60);
        for (let i = 0; i < count; i++) {
          particles.push({
            x: Math.random() * w,
            y: Math.random() * h,
            vx: (Math.random() - 0.5) * 0.3,
            vy: (Math.random() - 0.5) * 0.3,
            r: 1 + Math.random() * 2,
            alpha: 0.1 + Math.random() * 0.6
          });
        }
      }

      function draw() {
        ctx.clearRect(0, 0, w, h);
        const g = ctx.createLinearGradient(0, 0, w, h);
        g.addColorStop(0, 'rgba(6,7,10,0.6)');
        g.addColorStop(1, 'rgba(8,17,41,0.3)');
        ctx.fillStyle = g;
        ctx.fillRect(0, 0, w, h);

        for (let p of particles) {
          p.x += p.vx;
          p.y += p.vy;
          if (p.x < 0) p.x = w;
          if (p.x > w) p.x = 0;
          if (p.y < 0) p.y = h;
          if (p.y > h) p.y = 0;
          ctx.beginPath();
          ctx.fillStyle = `rgba(110,231,183,${p.alpha})`;
          ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
          ctx.fill();
        }
        requestAnimationFrame(draw);
      }

      return {
        init: () => {
          window.addEventListener('resize', resizeCanvas);
          resizeCanvas();
          draw();
          console.log('Particle Manager initialized.');
        }
      };
    })();

    // --- Card Tilt & Interaction Module ---
    const cardManager = (function() {
      const card = document.getElementById('card');
      let isDown = false;
      let startX = 0, startY = 0;
      let rotX = 0, rotY = 0;

      function clamp(v, a, b) {
        return Math.max(a, Math.min(b, v));
      }

      function handlePointerMove(e) {
        const rect = card.getBoundingClientRect();
        const cx = rect.left + rect.width / 2;
        const cy = rect.top + rect.height / 2;
        const dx = e.clientX - cx;
        const dy = e.clientY - cy;
        const tiltX = clamp(dy / rect.height * -20, -25, 25);
        const tiltY = clamp(dx / rect.width * 20, -25, 25);
        card.style.transform = `perspective(900px) rotateX(${tiltX}deg) rotateY(${tiltY}deg) translateZ(10px)`;
      }

      return {
        init: () => {
          window.addEventListener('pointermove', handlePointerMove);
          card.addEventListener('pointerdown', (e) => {
            isDown = true;
            card.style.cursor = 'grabbing';
            startX = e.clientX;
            startY = e.clientY;
          });
          window.addEventListener('pointerup', () => {
            isDown = false;
            card.style.cursor = 'grab';
            card.style.transform = `perspective(900px) rotateX(0deg) rotateY(0deg)`;
          });
          console.log('Card Manager initialized.');
        }
      };
    })();

    // --- Utility Functions Module ---
    const utils = (function() {
      async function htmlToImage(node) {
        const rect = node.getBoundingClientRect();
        const clone = node.cloneNode(true);
        const style = getComputedStyle(document.documentElement).cssText;
        const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='${rect.width}' height='${rect.height}'><foreignObject width='100%' height='100%'><div xmlns='http://www.w3.org/1999/xhtml' style='${style}'>${new XMLSerializer().serializeToString(clone)}</div></foreignObject></svg>`;
        const blob = new Blob([svg], { type: 'image/svg+xml;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const img = new Image();
        img.width = rect.width;
        img.height = rect.height;
        return await new Promise((res, rej) => {
          img.onload = () => {
            const c = document.createElement('canvas');
            c.width = rect.width;
            c.height = rect.height;
            const cx = c.getContext('2d');
            cx.fillStyle = 'transparent';
            cx.fillRect(0, 0, c.width, c.height);
            cx.drawImage(img, 0, 0);
            URL.revokeObjectURL(url);
            res(c.toDataURL('image/png'));
          };
          img.onerror = rej;
          img.src = url;
        });
      }

      function downloadURI(uri, name) {
        const a = document.createElement('a');
        a.href = uri;
        a.download = name;
        document.body.appendChild(a);
        a.click();
        a.remove();
      }

      return {
        htmlToImage,
        downloadURI
      };
    })();

    // Initialize all modules
    document.addEventListener('DOMContentLoaded', () => {
      uiManager.init();
      alienEyesManager.init(); // New module initialization
      particleManager.init();
      cardManager.init();
    });
  </script>
</body>
</html>